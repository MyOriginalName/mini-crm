# Потоки данных в Mini-CRM

## 1. Аутентификация и авторизация

### Процесс входа
1. Пользователь вводит учетные данные
2. Система проверяет учетные данные
3. Загружаются роли и разрешения пользователя
4. Создается сессия
5. Формируется доступный функционал на основе ролей

### Проверка прав доступа
1. Каждый запрос проходит через middleware
2. AdminMiddleware проверяет доступ к админ-панели
3. Проверяются конкретные разрешения для ресурсов
4. Применяются ограничения на основе роли

## 2. Управление данными

### Клиенты
1. Создание клиента
   - Валидация данных
   - Создание записи
   - Назначение ответственного
   - Создание истории

2. Обновление информации
   - Проверка прав
   - Обновление данных
   - Логирование изменений

### Сделки
1. Создание сделки
   - Привязка к клиенту
   - Установка статуса
   - Назначение менеджера
   - Создание задач

2. Изменение статуса
   - Проверка прав
   - Обновление статуса
   - Уведомления

### Задачи
1. Создание задачи
   - Привязка к сделке
   - Назначение исполнителя
   - Установка сроков

2. Отслеживание
   - Обновление статуса
   - Комментарии
   - Уведомления

## 3. Система ролей и разрешений

### Инициализация
1. Запуск сидеров
   - PermissionSeeder: создание разрешений и ролей
   - TestUserSeeder: создание тестовых пользователей

### Управление правами
1. Администраторы
   - Управление ролями
   - Назначение разрешений
   - Просмотр логов

2. Менеджеры
   - Работа с клиентами
   - Управление сделками
   - Назначение задач

3. Пользователи
   - Просмотр данных
   - Работа с задачами
   - Ограниченный доступ

## 4. Кэширование и производительность

### Кэширование данных
1. Роли и разрешения
2. Часто используемые данные
3. Статистика и отчеты

### Оптимизация запросов
1. Индексация базы данных
2. Оптимизация запросов
3. Ленивая загрузка связей 

## 5. Логирование действий

### Система логирования
1. Автоматическое логирование через trait Loggable
   - Создание (created)
   - Обновление (updated)
   - Удаление (deleted)

2. Структура лога
   - user_id: ID пользователя, совершившего действие
   - action: Тип действия (created/updated/deleted)
   - entity_type: Тип сущности
   - entity_id: ID сущности
   - old_values: Старые значения (для updated)
   - new_values: Новые значения (для updated)
   - description: Описание действия

3. Отображение логов
   - Доступно только в админ-панели
   - Постраничная навигация
   - Цветовая индикация действий
   - Фильтрация по типам действий
   - Группировка по пользователям

4. Контекст действий
   - Сохранение полной информации о действии
   - Возможность отслеживания изменений
   - История действий пользователей
   - Аудит безопасности 